project.ext {

  cfgVersion = "1.1.3"

  cfgGroup = "org.emoncms"

  cfgCopyDependencies = false

  cfgCopyToRoot = false

  javaProjects = subprojects

  distributionProjects = subprojects.findAll {
    it.getPath() == ":emoncms-api" ||
    it.getPath() == ":emoncms-http" ||
    it.getPath() == ":openmuc-datalogger-emoncms"
  }

  docProjects = distributionProjects.findAll {
    it.getPath() == ":emoncms-api"
  }

}

configure(javaProjects) {
  apply plugin: "java"
  apply plugin: "maven"
}

tasks.withType(Tar) {

  into(project.name) {

    from("./") {
      include "build.gradle"
      include "configuration.gradle"
      include "LICENSE**"
      include "gradle/wrapper/**"
      include "gradlew"
      include "gradlew.bat"
      include "build/libs/**"
      include "dependencies/**"

      exclude "**/projects/**/bin"
      exclude "**/projects/**/build"
      exclude "**/projects/**/.settings"
      exclude "**/projects/**/.project"
      exclude "**/projects/**/.classpath"
      exclude "**/projects/**/.gradle"

      for (Project myproject: distributionProjects) {
        include myproject.getProjectDir().toString().substring((int)(getProjectDir().toString().size() + 1)) + "/**";
      }
    }

    if (name.equals("tar") ){
      exclude "**/dependencies/**/src"
    }

    from("./build/") {
      include "settings.gradle"
    }
  }

  into(project.name + "/doc/") {
    from("./build/docs/") {
      include "javadoc/**"
    }
  }
}
